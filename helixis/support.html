<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" type="text/css" href="support.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css'>
  <!--<link rel="stylesheet" type="text/css" href="bootstrap-4.0.0/bootstrap-4.0.0/dist/css/bootstrap.min.css">
 <link rel="stylesheet" type="text/css" href="bootstrap.min.css">-->
<link rel='stylesheet' href='https://unicons.iconscout.com/release/v3.0.6/css/line.css'>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!--<link rel="stylesheet" type="text/css" href="unicons-master/unicons-master/css/thinline.css">-->
<!--<link rel="stylesheet" type="text/css" href="line.css">-->
<link rel="stylesheet" href="./style.css">
<link rel="stylesheet" href="./schedule.css">
<link rel="stylesheet" href="app.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


<style type="text/css">

  /*start search*/

  #myInput {
  background-image: url('/css/searchicon.png');
  background-position: 10px 12px;
  background-repeat: no-repeat;
  width: 100%;
  font-size: 16px;
  padding: 12px 20px 12px 40px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
}

#myInputhospital {
  background-image: url('/css/searchicon.png');
  background-position: 10px 12px;
  background-repeat: no-repeat;
  width: 100%;
  font-size: 16px;
  padding: 12px 20px 12px 40px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
}

#myUL {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

#myULhospital {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

#myUL li a {
  border: 1px solid #ddd;
  margin-top: -1px; /* Prevent double borders */
  background-color: #f6f6f6;
  padding: 12px;
  text-decoration: none;
  font-size: 18px;
  color: black;
  display: block
}

#myULhospital li a {
  border: 1px solid #ddd;
  margin-top: -1px; /* Prevent double borders */
  background-color: #f6f6f6;
  padding: 12px;
  text-decoration: none;
  font-size: 18px;
  color: black;
  display: block
}

#myUL li a:hover:not(.header) {
  background-color: #eee;
}

#myULhospital li a:hover:not(.header) {
  background-color: #eee;
}

  /*end search*/
  
.sidebar {
  width: 17.9%;
}


.chart-container1 {
  margin-left: 4%;
  width:90% !important;
  background-color: rgba(255, 255, 255, .5);
}

.headertext {
  margin-left: 7%;
}

.charts {
  margin-top: -2rem;
}

.specialty{
  margin-top: 20px;
}

.specialtycondition{
  margin-top: 20px;
}

.specialty li{
  height: 40px;
  border-bottom: 1px solid white;
  padding-top: 10px;
  color: white;
}
.specialtycondition li{
  height: 40px;
  border-bottom: 1px solid white;
  padding-top: 10px;
  color: white;
}

.specialty li:hover{
  background-color: whitesmoke;
  color: black;
  padding-left: 10px;
  border-radius: 2px;
  cursor: pointer;
  transition: 0.8s;
}

.specialtycondition li:hover{
  background-color: whitesmoke;
  color: black;
  padding-left: 10px;
  border-radius: 2px;
  cursor: pointer;
  transition: 0.8s;
}

.w3-button{
  color: white;
}

.otherelements{
  background-color: transparent;
  backdrop-filter: blur(3px);
  scrollbar-color: aqua;
}

#inputaddress{
  color: black;
  display: none;
  width: 80%;
  height: 50px;
  background-color: transparent;
  backdrop-filter: blur(2px);
  border: none;
  border-bottom: 2px solid aqua;
}

#inputaddress: hover{
  border: none;
}

.specialty li.on{
  background-color: white;
  color: black;
  padding-left: 10px;
}

.specialtycondition li.on{
  background-color: white;
  color: black;
  padding-left: 10px;
}

.calenderbtn{
  width: 40%;
}

.scheduled{
  float: right;
}

iframe{
  width: 80vw;
  height: 55vh;
}

.scheduletext{
  text-align: center;
  border: none;
}

span.fa{
  float: right;
}


.next{
  float: right;
}

.star_rating{
  margin-left: 80%;
  margin-top: -15px;
}

.star{
  font-size: 21px;
  background-color: unset;
}
.star:hover{
  color: yellow;
  background-color: unset;
}


.star_rating ~ .star:hover {
  color: yellow;
  background-color: unset;
}

.sendloc{
  float: right;
  margin-right: 5rem;
  margin-top: -3rem;
  border: 3px solid black;
  padding: 9px;
  border-radius: 4rem;
  display: none;
}

.cancelbook{
  border: 2px solid white;
  border-radius: ;
}

.proimg{
    margin-top: 30%;
    width: 60px !important;
    height: 60px !important;
  }

  .sidetext:hover{
    background: grey;
    color: white !important;
  }

  .imgrobot{
    text-align: center;
  }
  .imgconsult{
    width: 200px !important;
    height: 200px !important;
  }

  .Qtxt{
    text-align: center;
    margin-top: 20px;
  }

  .Ftxt{
    font-weight: 900;
    font-size: 22px;
  }


  .btns{
  display: inline-block;
  padding: .75rem 1.25rem;
  border-radius: 10rem;
  color: black;
  text-transform: uppercase;
  font-size: 1rem;
  letter-spacing: .15rem;
  position: relative;
  overflow: hidden;
  z-index: 1;
  cursor: pointer;
  }

  /* Button used to open the chat form - fixed at the bottom of the page */
.open-button {
  background-color: #555;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  opacity: 0.8;
  position: fixed;
  bottom: 23px;
  right: 28px;
  width: 280px;
}

/* The popup chat - hidden by default */
.chat-popup {
  display: none;
  position: fixed;
  bottom: 0;
  right: 15px;
  border: 3px solid #f1f1f1;
  z-index: 9;
}

/* Add styles to the form container */
.form-container {
  max-width: 300px;
  padding: 10px;
  background-color: white;
}

/* Full-width textarea */
.form-container textarea {
  width: 100%;
  padding: 15px;
  margin: 5px 0 22px 0;
  border: none;
  background: #f1f1f1;
  resize: none;
  min-height: 200px;
}

/* When the textarea gets focus, do something */
.form-container textarea:focus {
  background-color: #ddd;
  outline: none;
}

/* Set a style for the submit/send button */
.form-container .btn {
  background-color: #04AA6D;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  width: 100%;
  margin-bottom:10px;
  opacity: 0.8;
}

/* Add a red background color to the cancel button */
.form-container .cancel {
  background-color: red;
}

/* Add some hover effects to buttons */
.form-container .btn:hover, .open-button:hover {
  opacity: 1;
}
   
</style>
</head>
<body>
<!-- partial:index.partial.html -->
<aside class="sidebar position-fixed top-0 left-0 overflow-auto h-100 float-left" id="show-side-navigation1">
  
  

  <div class="search position-relative text-center px-4 py-3 mt-2" id="nearbystops">
    <img class="proimg" src="man-g24ba357cd_1280.jpg">
    <p class="sidebarname"></p>
  </div>

  <ul class="categories list-unstyled">
    <li class="sidetext" onclick="dashboard()">
      <i class="uil-estate fa-fw"></i><a href="#"> Dashboard</a>
    </li>
    <li class="sidetext" onclick="toappointments()">
      <i class="uil-calendar-alt"></i><a href="#"> Book Appointment</a>
    </li>
    <li class="sidetext" onclick="appointmentlist()">
      <i class="uil-file fa-fw"></i><a href="#"> Appointments</a>
    </li>
    <li class="sidetext" onclick="todoctors()">
      <i class="uil-comment-message"></i>
      <a href="#"> Doctors</a>
    </li>
    <li class="sidetext" onclick="toprofile()">
      <i class="uil-file-medical"></i>
      <a href="#" class="profileitem">   
        Profile
      </a>
    </li>
    <li class="sidetext">
      <i class="uil-file-medical"></i><a href="#"> Support</a>
    </li>
    <li class="sidetext" onclick="">
      <i class="uil-file-medical"></i>
      <a href="#"> Logout</a>
    </li>
  </ul>
</aside>

<section id="wrapper">
  <nav class="navbar navbar-expand-md">
    <div class="container-fluid mx-2">
      <div class="navbar-header">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#toggle-navbar" aria-controls="toggle-navbar" aria-expanded="false" aria-label="Toggle navigation">
          <i class="uil-bars text-white"></i>
        </button>
        
      </div>
      <div class="collapse navbar-collapse" id="toggle-navbar">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link">
              
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>                                                                                                                   
  <div class="p-4 .mt-5">
    <div class="headtext">
      <div class="query">
        <p class="headertext"></p>
      </div>
    </div>
    <section class="charts">
      <div class="row">
        <div class="col-lg-12">
          <div class="chart-container1 p-4 medics activity">
            
                      <!-- start-->

                    <div>

                      <div class="imgrobot">
                        <img src="robot-3156763_1280.png" class="imgconsult">
                      </div>
                      <div class="Qtxt">
                        <p class="Ftxt">ARE YOU FACING ANY PROBLEM?</p>
                        <p style="font-weight: 600;">If you require urgent support kindly use the live chat, however you may also use the open ticket and our consultants will be with you as soon as posible</p>
                      </div>
                      <div style="text-align: center;">
                        <span class="btns" style="border: 2px solid #44ebb3;" onclick="openForm()">start live chat</span>
                        <span class="btns" style="border: 2px solid #28b3de;margin-left: 15px;">open a ticket</span>
                      </div>
                      <div class="chat-popup" id="myForm">
  <form action="/action_page.php" class="form-container">
    <h1>Chat</h1>

    <label for="msg"><b>Message</b></label>
    <textarea placeholder="Type message.." name="msg" required></textarea>

    <button type="submit" class="btn">Send</button>
    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
  </form>
</div>
                      <div style="text-align: center;margin-top: 50px;">
                        <div>
                          <p style="font-weight: 900;">Or you can contact us on</p>
                        </div>
                        <div>
                          <span>Email: helixinfo31@gmail.com</span>
                          <span style="margin-left: 2rem;">Phone: 000 0000 000</span>
                        </div>
                      </div>
                      
                      
                    </div>
                      <!--end-->

          </div>
        </div>
      </div>
    </section>

  </div>
</section>

<!-- partial -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.17/dist/sweetalert2.all.min.js"></script>
<script src="https://smtpjs.com/v3/smtp.js"></script>
 <!-- TODO: Add SDKs for Firebase products that you want to use 

 https://firebase.google.com/docs/web/setup#available-libraries -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <!--<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-analytics.js"></script>-->

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>

<script type="text/javascript">

   // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAybUF58ye2xdEx5Cty63VQYf0aWjhfLjQ",
  authDomain: "helix-3ee55.firebaseapp.com",
  databaseURL: "https://helix-3ee55-default-rtdb.firebaseio.com/",
  projectId: "helix-3ee55",
  storageBucket: "helix-3ee55.appspot.com",
  messagingSenderId: "794490224146",
  appId: "1:794490224146:web:8313c7d926b0b91a6722cb"
  };



// Initialize Firebase
firebase.initializeApp(firebaseConfig);
// Initialize variables
const auth = firebase.auth()
const database = firebase.database()

const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

 function dashboard(){
    location.href ="index.html?userid=" + useruid + "&booknum=" + booknum;
  }


  function openForm() {
  document.getElementById("myForm").style.display = "block";
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
}

function toappointments(){

    const queryString = window.location.search;
    console.log(queryString);
    const urlParams = new URLSearchParams(queryString);

    const product = urlParams.get('userid')
    console.log(product);

var appointmentname = Date.now();

  location.href = "activities.html" + queryString + "&booknum=" + appointmentname;
  }

  function appointmentlist(){

    const queryString = window.location.search;
    console.log(queryString);
    const urlParams = new URLSearchParams(queryString);

    const product = urlParams.get('userid')
    console.log(product);

var appointmentname = Date.now();

  location.href = "appointments.html" + queryString + "&booknum=" + appointmentname;
  }




  firebase.database().ref("Patient/" + useruid).on("value",function(element){

  var data = element.val();

  var name = data.First_Name;
  var surname = data.Last_name;
  var imager = data.Logo;
  var idNumber = data.Address;

document.querySelector(".sidebarname").innerHTML = name + " " + surname;

document.querySelector(".proimg").src = imager;


})



  var addressinput = document.querySelector(".sendloc");

  addressinput.addEventListener("click", function(){
    var thedress = document.getElementById("inputaddress").value


    var address = {
    address: thedress
  }

     firebase.database().ref("Appoiments/location/" + useruid + "/" + booknum).update(address);
  })



  firebase.database().ref("Appoiments/ratedcondition/" + useruid + "/" + booknum).on("value",function(snapshot){


    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

var total = 0;

var num = snapshot.val();
console.log(snapshot.val());

    for (var [key, value] of Object.entries(num)) {

  total += value;
  console.log(total);
  console.log(value, key);


  //0-20 booking in the next 7 days
  if (total < 20) {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

    //check the date
    var today;
    var daydue = new Date().getDate() + 6;
    var mondue = new Date().getMonth();
    var yeardue = new Date().getFullYear();
    today = new Date(yeardue, mondue, daydue);

    var date = {
    day: today,
  }
  

  firebase.database().ref("Appoiments/date/" + useruid + "/" + booknum).update(date);
    
    //set seven days after today
    //send that day to the database
  }else if (total == 21 || total > 21 || total == 35) {
    //send
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

    var today;
    var daydue = new Date().getDate() + 3;
    var mondue = new Date().getMonth();
    var yeardue = new Date().getFullYear();
    today = new Date(yeardue, mondue, daydue);

    var date = {
    day: today,
  }

  firebase.database().ref("Appoiments/date/" + useruid + "/" + booknum).update(date);
  }//21-35 booking in the next 2-5 days
   else if (total == 36 || total > 36 || total == 50) {
    //send

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')


    var today;
    var daydue = new Date().getDate() + 1;
    var mondue = new Date().getMonth();
    var yeardue = new Date().getFullYear();
    today = new Date(yeardue, mondue, daydue);
    var date = {
    day: today,
  }

  firebase.database().ref("Appoiments/date/" + useruid + "/" + booknum).update(date);
  }//36-50 booking in the next 24 hours

}

  });

  firebase.database().ref("symptomps").on("value",function(snapshot){


    var snappy = snapshot.val();
    snapshot.forEach(function(element){

      

      var thevalues = element.val();

      document.querySelector('.specialtycondition').innerHTML += `<li id="${thevalues}" class="${thevalues}" value="${thevalues}">${thevalues}
          <div class="star_rating">
          <span value="${thevalues}" class="star ${thevalues}" id="1" onclick="rating(${thevalues}, 1)">&#9734;</span>
          <span value="${thevalues}" class="star ${thevalues}" id="2" onclick="rating(${thevalues}, 2)">&#9734;</span>
          <span value="${thevalues}" class="star ${thevalues}" id="3" onclick="rating(${thevalues}, 3)">&#9734;</span>
          <span value="${thevalues}" class="star ${thevalues}" id="4" onclick="rating(${thevalues}, 4)">&#9734;</span>
          <span value="${thevalues}" class="star ${thevalues}" id="5" onclick="rating(${thevalues}, 5)">&#9734;</span>
          </div>
          
        </li>`;


/*

    var one = document.getElementById(1);
    var two = document.getElementById(2);
    var three = document.getElementById(3);
    var four = document.getElementById(4);
    var five = document.getElementById(5);

    one.onmouseover = function(){

      one.style.color = "yellow";

    }

    two.onmouseover = function(){

      one.style.color = "yellow";
      two.style.color = "yellow";

    }

    three.onmouseover = function(){

      one.style.color = "yellow";
      two.style.color = "yellow";
      three.style.color = "yellow";

    }

    four.onmouseover = function(){

      one.style.color = "yellow";
      two.style.color = "yellow";
      three.style.color = "yellow";
      four.style.color = "yellow";

    }

    five.onmouseover = function(){

      one.style.color = "yellow";
      two.style.color = "yellow";
      three.style.color = "yellow";
      four.style.color = "yellow";
      five.style.color = "yellow";

    }

    */

  
       /* const rated = document.querySelectorAll('.star');
            rated.
    
    rated.forEach((star, i) => {
      star.addEventListener('click', ()=> {
        console.log(`${star} ${i + 1} was clicked`);
      });
            star.innerHTML = '&#9733';
            star.innerHTML = '&#9734';
    })*/

    })

    /* var symptoms = snapshot.val();


     var conditions = Object.entries(symptoms);

     var element = document.querySelector('.specialtycondition');
     for (const [key, value] of Object.entries(symptoms)) {
  console.log(`${key}: ${value}`);
}


  
        
*/
  })

  

  function myFunction() {
    var input, filter, ul, li, a, i, txtValue;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        txtValue = a.textContent || a.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";
        }
    }
}



function myhospital() {
    var input, filter, ul, li, a, i, txtValue;
    input = document.getElementById("myInputhospital");
    filter = input.value.toUpperCase();
    ul = document.getElementById("myULhospital");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        txtValue = a.textContent || a.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";
        }
    }
}

function adddoctor(doc){

  var doctor = doc.id;

   var doctorobj = {
    doctor: doctor
  }

  firebase.database().ref("Appoiments/doctor").update(doctorobj);
}

function addhospital(hos){

  var hospital = hos.id;

   var hospitalobj = {
    hospital: hospital
  }

  firebase.database().ref("Appoiments/hospital").update(hospitalobj);
}

/*

firebase.database().ref("doctors").on("value",function(snapshot){
      /*document.getElementById().value = snapshot.val().nameofthething;
      //var results = snapshot.val();
      snapshot.forEach(function(element){
        element.forEach(function(item){
item.forEach(function(output){

var results = output.val();
//for (var i in results) {

//console.log(results);
//}
   })

})

 })
    })

*/

/*document.querySelector("#specialtyitem").addEventListener("click", ()=> {

  var test = document.getElementById('specialtyitem');
alert(test.value);

 // const variable = document.getElementById().value;
 // firebase.database().ref("Appoiments").push(email);
});*/

function startappoint(){


const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
  

    var linker = '?userid=' + useruid;
    var linkey = '?userid=' + useruid + '&booknum=' + booknum;

if (queryString == linker) {
  document.getElementById('specialty').style.display='none';
} else if(queryString == linkey) {
  document.getElementById('specialty').style.display='block';
}

}


function active(val){

  const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')


  const specialist = val.className;

  var specialistobj = {
    Specialty: specialist
  }

  firebase.database().ref("Appoiments/specialist/" + useruid + "/" + booknum).set(specialistobj).then(function(){
    firebase.database().ref("Appoiments/specialist/" + useruid + "/" + booknum).on("value",function(snapshot){

      var valueofsnap = snapshot;

  //console.log(valueofsnap.length);

  snapshot.forEach(function(element){

  var valueofsnap = element.val();

  //console.log(valueofsnap.length);
var getitem = document.querySelector(".starbtn");
//console.log(getitem);
  
  

// find all the elements in your channel list and loop over them
  Array.prototype.slice.call(document.querySelectorAll('ul[data-tag="channelList"] li')).forEach(function(elem){
    // remove the selected class
    elem.classList.remove('on');
  });

val.classList.add('on');

    
    


   })
  })
  })




}

function rating(val, num){

  


  const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

         
  const conditionlist = val.className;
  const number = num;

  var conditionobj = {
    [conditionlist]: number
  }
  firebase.database().ref("Appoiments/ratedcondition/" + "/" + useruid + "/" + booknum).update(conditionobj);

   if (conditionlist !== 'on') {
    

    val.className = "on";
    


     //rated.style.fontSize = '25px';
     
    
  }else if(conditionlist == 'on'){

    var theidname = val.id;
    

     
    val.className = val.id;


      firebase.database().ref("Appoiments/ratedcondition/" + "/" + useruid + "/" + booknum + "/" + conditionlist).remove();
      firebase.database().ref("Appoiments/ratedcondition/" + "/" + useruid + "/" + booknum + "/" + theidname).remove();
    
    
  }

  if (num == 1) {

    
 document.addEventListener('click', function(e) {
    e = e || window.event;
    var target = e.target || e.srcElement
        //text = target.textContent || target.innerText; 
        //console.log(e.clientX);
        target.style.color = "#2de810";
        
}, false);


  }else if (num == 2) {

     document.addEventListener('click', function(e) {
    e = e || window.event;
    var target = e.target || e.srcElement
        //text = target.textContent || target.innerText;
        target.style.color = "#2de810";
        target.previousElementSibling.style.color = "#2de810";
        //var second = target.nextElementSibling;

        //second.style.color = "#2de810"
}, false);

  }else if (num == 3) {

    document.addEventListener('click', function(e) {
    e = e || window.event;
    var target = e.target || e.srcElement
        //text = target.textContent || target.innerText;
        target.style.color = "#2de810";
        var second = target.previousElementSibling;

          second.style.color = "#2de810";
          var first = second.previousElementSibling;
          first.style.color = "#2de810";
        //var second = target.nextElementSibling;

        //second.style.color = "#2de810"
}, false);
  }else if (num == 4) {
    
document.addEventListener('click', function(e) {
    e = e || window.event;
    var target = e.target || e.srcElement
        //text = target.textContent || target.innerText;
        target.style.color = "#2de810";
        var third = target.previousElementSibling;

          third.style.color = "#2de810";

          var second = third.previousElementSibling;

          second.style.color = "#2de810";

         var first = second.previousElementSibling;
         first.style.color = "#2de810";


        //var second = target.nextElementSibling;

        //second.style.color = "#2de810"
}, false);

  }else if (num == 5) {

    document.addEventListener('click', function(e) {
    e = e || window.event;
    var target = e.target || e.srcElement
        //text = target.textContent || target.innerText;
        target.style.color = "#2de810";
        var four = target.previousElementSibling;

          four.style.color = "#2de810";

          var third = four.previousElementSibling;

          third.style.color = "#2de810";

          var second = third.previousElementSibling;

          second.style.color = "#2de810";

          second.previousElementSibling.style.color = "#2de810";


        //var second = target.nextElementSibling;

        //second.style.color = "#2de810"
}, false);
  }

}


function locationeraddress(val) {

  const success = (position) => {

  var theaddress = val.textContent;
  const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

    var addressobj = {
    [addressobj]: theaddress
  }

     firebase.database().ref("Appoiments/location/" + useruid + "/" + booknum).update(addressobj);

      firebase.database().ref("doctors").on("value",function(element){

        //console.log(Object.keys(element.val()).length);
    element.forEach(function(snapshot){

    var thedoctor = snapshot.val();
    
var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;
    
  

    var data = [{
        "code": "0001",
        "lat": "1.28210155945393",
        "lng": "103.81722480263163",
        "location": "Stop 1"
    }, {
        "code": "0003",
        "lat": "1.2777380589964",
        "lng": "103.83749709165197",
        "location": "Stop 2"
    }];

    var html = "";
    var poslat = latitude;
    var poslng = longitude;

    function distance(lat1, lon1, lat2, lon2, unit) {
      var radlat1 = Math.PI * lat1/180
      var radlat2 = Math.PI * lat2/180
      var theta = lon1-lon2
      var radtheta = Math.PI * theta/180
      var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
      if (dist > 1) {
        dist = 1;
      }
      dist = Math.acos(dist)
      dist = dist * 180/Math.PI
      dist = dist * 60 * 1.1515
      if (unit=="K") { dist = dist * 1.609344 }
      if (unit=="N") { dist = dist * 0.8684 }
      return dist
    }

    for (var i = 0; i < data.length; i++) {
        // if this location is within 0.1KM of the user, add it to the list
        if (distance(poslat, poslng, thedoctor.latitude, thedoctor.longitude, "K") <= 1 || distance(poslat, poslng, thedoctor.latitude, thedoctor.longitude, "K") <= 2) {
            html = data[i];
            //console.log(html);
        }
    }

    document.querySelector('#nearbystops').append(html);
    })

  })
  } //success cordinates
 const error = () => {
    status.textContent = 'unable to retrieve your location';
  }
      navigator.geolocation.getCurrentPosition(success, error);
}

firebase.database().ref("doctors").on("value",function(element){

  element.forEach(function(snapshot){

  //console.log(snapshot.val().latitude);

  })

  })




function locationer(){  

  const success = (position) => { 

    var latitude = position.coords.latitude;
    var longitude = position.coords.longitude; 

       var locationobj = {
    latitude: latitude,
    longitude: longitude
  }

  const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

      firebase.database().ref("Appoiments/location/" + useruid + "/" + booknum).update(locationobj);

firebase.database().ref("Hospitals").on("value",function(element){ 


  var overall = Object.keys(element.val());

  console.log(element.val());
 

        var lengthdoc = overall.length;
    element.forEach(function(snapshot){ 

      snapshot.forEach(function(snaps){

        snaps.forEach(function(snapza){
          firebase.database().ref("Appoiments/specialist/" + useruid + "/" + booknum).on("value",function(specialdata){

    var specialtydata = specialdata.val().Specialty;
    console.log(specialtydata);

  console.log(snapza.val().Specialty);

  if (specialtydata == snapza.val().Specialty) {

    var docname = snapza.val().First_Name;
    var docLname = snapza.val().Last_name;
    var docmail = snapza.val().Email;

    var doctorobj = {
    Name: docname,
    Surname: docLname,
    Email: docmail
  }

        firebase.database().ref("Appoiments/doctor/" + useruid + "/" + booknum).update(doctorobj);

  }



        })
          })

      })

    var thehospital = snapshot.val();
    console.log([thehospital]);

    var hospitaldata = {
    Name: thehospital.Name,
    Address: thehospital.Address,
    latitude: thehospital.latitude,
    longitude: thehospital.longitude
  }

    firebase.database().ref("Appoiments/hospital/" + useruid + "/" + booknum).update(hospitaldata);


var html;
    var poslat = latitude;
    var poslng = longitude;

function distance(lat1, lon1, lat2, lon2, unit) {
      var radlat1 = Math.PI * lat1/180
      var radlat2 = Math.PI * lat2/180
      var theta = lon1-lon2
      var radtheta = Math.PI * theta/180
      var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
      if (dist > 1) {
        dist = 1;
      }
      dist = Math.acos(dist)
      dist = dist * 180/Math.PI
      dist = dist * 60 * 1.1515
      if (unit=="K") { dist = dist * 1.609344 }
      if (unit=="N") { dist = dist * 0.8684 }
      return dist
    }

    
    for (var i = 0; i < lengthdoc; i++) { 

        var distances = distance(poslat, poslng, thehospital.latitude, thehospital.longitude, "K");

        //console.log(distances);

        if (distances < 1) {
          
            alert("less than 1km");
        }else if(distances < 50){ 

          

          console.log(distances);

          var hospiname = element.val();
          var doc = Object.keys(hospiname);
          //console.log(doc);
          let numid = parseInt(doc);
  //console.log(numid);



          


          Swal.fire(
  'Appointment set!',
  'an email containing all information regarding your appoitment has been sent to the email address you registered with!',
  'success'
).then(function(){ 


  firebase.database().ref("Patient/"+useruid).on("value",function(patientdata){ 



  firebase.database().ref("Patient/"+useruid).on("value",function(userdata){

    var userinfo = userdata.val();

    firebase.database().ref("Appoiments/date/"+useruid+"/"+booknum).on("value",function(datadate){


  
var dater = datadate.val();
var todate = dater.day;

const thedate = todate.split('T')[0]
    //console.log(datadate.val());
    var userdata = patientdata.val();
    const username = userdata.First_Name;
    const email = userdata.Email;

    var user = userinfo.First_Name + " " + userinfo.Last_name;

    var usermail = userinfo.Email;

     gophp(user, usermail)

    //hey [username] we have assigned your with doctor [who] at [address] on the [date]

      
     
   })
  })

})
    

    document.querySelector('#nearbystops').append(html);

  }) 

    

    }
  }
  
   }) 
  }) 


   
 } 
 const error = () => {
    status.textContent = 'unable to retrieve your location';
  } 
  navigator.geolocation.getCurrentPosition(success, error);
}


function gophp(user, usermail){

  

  

  firebase.database().ref("Appoiments/date/" + useruid + "/" + booknum).on("value",function(dataval){

    var dater = dataval.val();
    var todate = dater.day;

const thedate = todate.split('T')[0]

firebase.database().ref("Appoiments/doctor/" + useruid + "/" + booknum).on("value",function(docval){

  var docdata = docval.val();

  firebase.database().ref("Appoiments/hospital/" + useruid + "/" + booknum).on("value",function(hosval){


    var hosdata = hosval.val();

    var hosname = hosdata.Name;
    var hosadd = hosdata.Address;
    var dr = docdata.Name + " " + docdata.Surname;
    console.log(user);
    console.log(usermail);

    /*

    username: helixinfo31@gmail.com,
    Password: 77141F2C361EEE436245687801E5B3F06247
    Server: smtp.elasticemail.com
    Port: 2525

    Security Token: c3330c13-00c5-4488-a292-5bdbecf6d428

    //////////////////////////////////////////////////////

    katlegomatshwi@outlook.com
    543C027040C9836C0F9F22E73EAD71E8861C

    Security Token: def72b47-ecea-4f8d-b201-ed9974e3c600
    */


Email.send({
    SecureToken : "c3330c13-00c5-4488-a292-5bdbecf6d428",
    To : usermail,
    From : "matshwikatlego@gmail.com",
    Subject : "Appoitment Set",
    Body : `Hi ${user} 

    I have you scheduled to meet with doctor ${dr} at ${hosname} located at ${hosadd} on ${thedate} Please contact this number 011 234 5678 or info@helix.com if you have any questions before the meeting.email

     your timely attendance to this appointment, will be very much Appreciated.

     Sincerely,
     Helix Team`
}).then(
  message => alert(message)
);

   /* location.href = "./PHPMailer/mail.php?docname=" + dr + "&hosname="+ hosname + "&hosadd="+ hosadd + "&date="+ thedate + "&name=" + user + "&mail=" + usermail;*/


    })
   })

  });

}





function nextCondition(){
  document.getElementById('specialty').style.display='none';
  document.getElementById('condition').style.display='block';
}

function nextLocation(){
  document.getElementById('condition').style.display='none';
  document.getElementById('location').style.display='block';
}




/*

console.log(calcCrow(-25.652698384379825,28.227487535167622,-25.660679718090567,28.234572930323047).toFixed(1));

const arr = [1, 2, 3, 4, 5];

var sum = 0;

for (var number of arr) {
    sum += number;
}

average = sum / arr.length;

console.log(average);

    //This function takes in latitude and longitude of two location and returns the distance between them as the crow flies (in km)
    function calcCrow(lat1, lon1, lat2, lon2) 
    {
      var R = 6371; // km
      var dLat = toRad(lat2-lat1);
      var dLon = toRad(lon2-lon1);
      var lat1 = toRad(lat1);
      var lat2 = toRad(lat2);

      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = R * c;
      return d;
    }

    // Converts numeric degrees to radians
    function toRad(Value) 
    {
        return Value * Math.PI / 180;
    }


function distance(lat1, lon1, lat2, lon2, unit) {
      var radlat1 = Math.PI * lat1/180
      var radlat2 = Math.PI * lat2/180
      var theta = lon1-lon2
      var radtheta = Math.PI * theta/180
      var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
      if (dist > 1) {
        dist = 1;
      }
      dist = Math.acos(dist)
      dist = dist * 180/Math.PI
      dist = dist * 60 * 1.1515
      if (unit=="K") { dist = dist * 1.609344 }
      if (unit=="N") { dist = dist * 0.8684 }
      return dist
    }

*/


    
function preventBack() 
   {
   window.history.forward();

   }

  function todoctors(){

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

    location.href = "doctors.html?userid=" + useruid + "$booknum=" + booknum;
  }
  function toprofile(){

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const booknum = urlParams.get('booknum')
    const useruid = urlParams.get('userid')

    location.href = "profile.html?userid=" + useruid + "$booknum=" + booknum;
  }

</script>
<script src="app.js"></script>


<!--<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js'></script>-->

<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js'></script>

<script  src="./script.js"></script>

</body>
</html>
